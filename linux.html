<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ Linux & Sysadmin â€” Challenge Terminal</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone@7.24.0/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body, #root { height: 100%; width: 100%; }
    </style>
</head>
<body>
    <div id="root"></div>
  
    <script type="text/babel" data-presets="react">

const { useState, useEffect, useRef, useCallback } = React;

const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
const shuffle = (arr) => { const a = [...arr]; for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LEVEL GENERATORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const generateNavigationLevel = () => {
  const s = pick([
    { q: "Vous Ãªtes dans /home/user. Affichez le contenu du rÃ©pertoire courant.", a: (cmd) => /^ls(\s|$)/i.test(cmd), win: "âœ“ ls affiche les fichiers et dossiers ! Options utiles : ls -la (dÃ©taillÃ© + cachÃ©s), ls -lh (tailles lisibles).", hint: "La commande la plus basique pour lister les fichiers..." },
    { q: "DÃ©placez-vous dans le rÃ©pertoire /var/log.", a: (cmd) => /^cd\s+\/var\/log\s*$/i.test(cmd), win: "âœ“ cd /var/log â€” Vous Ãªtes dans le rÃ©pertoire des logs systÃ¨me !", hint: "cd = change directory" },
    { q: "Affichez le chemin du rÃ©pertoire oÃ¹ vous vous trouvez actuellement.", a: (cmd) => /^pwd\s*$/i.test(cmd), win: "âœ“ pwd (Print Working Directory) â†’ /home/user. Toujours savoir oÃ¹ on est !", hint: "3 lettres, signifie 'Print Working Directory'" },
  ]);
  return {
    id: "nav", title: "NAVIGATION FILESYSTEM",
    mission: `ğŸ“‹ MISSION :\n${s.q}\n\nTapez la commande Linux appropriÃ©e.`,
    hint: s.hint, topic: "Navigation & Filesystem",
    commands: {
      help: { response: ["â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—", "â•‘  Tapez votre commande Linux               â•‘", "â•‘  hint    - Obtenir un indice              â•‘", "â•‘  explain - Mini-cours navigation          â•‘", "â•‘  mission - Revoir l'Ã©noncÃ©                â•‘", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"] },
      explain: { response: ["ğŸ“– NAVIGATION LINUX", "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", "pwd â€” Afficher le rÃ©pertoire courant", "ls â€” Lister les fichiers", "  ls -l  (dÃ©taillÃ©)", "  ls -a  (fichiers cachÃ©s)", "  ls -la (les deux)", "cd â€” Changer de rÃ©pertoire", "  cd /chemin/absolu", "  cd dossier    (relatif)", "  cd ..         (parent)", "  cd ~          (home)", "  cd -          (prÃ©cÃ©dent)", "", "Chemins spÃ©ciaux :", "  /     racine", "  ~     home de l'utilisateur", "  .     rÃ©pertoire courant", "  ..    rÃ©pertoire parent"] },
    },
    checkWin: (input) => s.a(input),
    winResponse: [s.win],
    defaultResponse: () => null,
  };
};

const generateFileOpsLevel = () => {
  const s = pick([
    { q: "CrÃ©ez un fichier vide appelÃ© 'rapport.txt'.", a: (cmd) => /^touch\s+rapport\.txt\s*$/i.test(cmd), win: "âœ“ touch rapport.txt â€” Fichier crÃ©Ã© ! touch met aussi Ã  jour le timestamp si le fichier existe.", hint: "La commande pour crÃ©er un fichier vide commence par 'touch'" },
    { q: "Copiez le fichier 'config.ini' vers 'config.ini.bak' (backup).", a: (cmd) => /^cp\s+config\.ini\s+config\.ini\.bak\s*$/i.test(cmd), win: "âœ“ cp config.ini config.ini.bak â€” Toujours faire un backup avant de modifier un fichier de config !", hint: "cp = copy. Syntaxe : cp source destination" },
    { q: "Affichez le contenu du fichier '/etc/hostname'.", a: (cmd) => /^cat\s+\/etc\/hostname\s*$/i.test(cmd), win: "âœ“ cat /etc/hostname â†’ 'srv-web-01'. cat concatÃ¨ne et affiche le contenu des fichiers.", hint: "cat = concatenate. Affiche le contenu d'un fichier." },
  ]);
  return {
    id: "fileops", title: "OPÃ‰RATIONS FICHIERS",
    mission: `ğŸ“‹ MISSION :\n${s.q}\n\nTapez la commande Linux appropriÃ©e.`,
    hint: s.hint, topic: "Fichiers & RÃ©pertoires",
    commands: {
      help: { response: ["â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—", "â•‘  Tapez votre commande Linux               â•‘", "â•‘  hint    - Obtenir un indice              â•‘", "â•‘  explain - Mini-cours fichiers            â•‘", "â•‘  mission - Revoir l'Ã©noncÃ©                â•‘", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"] },
      explain: { response: ["ğŸ“– OPÃ‰RATIONS SUR FICHIERS", "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", "cat fichier â€” Afficher le contenu", "less fichier â€” Naviguer dans le contenu", "head -n 10 fichier â€” 10 premiÃ¨res lignes", "tail -n 10 fichier â€” 10 derniÃ¨res lignes", "touch fichier â€” CrÃ©er un fichier vide", "cp source dest â€” Copier", "mv source dest â€” DÃ©placer / Renommer", "rm fichier â€” Supprimer (ATTENTION !)", "  rm -r dossier â€” Supprimer rÃ©cursivement", "  rm -rf â€” Force sans confirmation", "mkdir dossier â€” CrÃ©er un rÃ©pertoire", "  mkdir -p a/b/c â€” CrÃ©er l'arborescence"] },
    },
    checkWin: (input) => s.a(input),
    winResponse: [s.win],
    defaultResponse: () => null,
  };
};

const generatePermissionsLevel = () => {
  const perms = pick([
    { display: "-rw-r--r--", owner: "alice", group: "dev", file: "secret.conf", q: "Le fichier 'secret.conf' a les permissions : -rw-r--r-- (alice:dev).\nRendez-le lisible et exÃ©cutable UNIQUEMENT par le propriÃ©taire (aucun droit pour les autres).", a: (cmd) => /^chmod\s+(700|u=rwx,go=|u=rwx,g=,o=)\s+secret\.conf/i.test(cmd), win: "âœ“ chmod 700 secret.conf â€” Seule Alice peut lire, Ã©crire et exÃ©cuter !", hint: "chmod 700 ou chmod u=rwx,go= ..." },
    { display: "-rwxrwxrwx", owner: "root", group: "root", file: "deploy.sh", q: "Le script 'deploy.sh' a les permissions -rwxrwxrwx (root:root).\nC'est DANGEREUX ! Restreignez Ã  : propriÃ©taire rwx, groupe rx, autres rien.", a: (cmd) => /^chmod\s+(750|u=rwx,g=rx,o=)\s+deploy\.sh/i.test(cmd), win: "âœ“ chmod 750 deploy.sh â€” Principe du moindre privilÃ¨ge appliquÃ© !", hint: "rwx=7, rx=5, rien=0. Donc 7-5-0..." },
  ]);
  return {
    id: "perms", title: "PERMISSIONS",
    mission: `ğŸ“‹ MISSION :\n${perms.q}\n\nTapez la commande chmod appropriÃ©e.`,
    hint: perms.hint, topic: "Permissions & SÃ©curitÃ©",
    commands: {
      help: { response: ["â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—", "â•‘  Tapez votre commande chmod               â•‘", "â•‘  hint    - Obtenir un indice              â•‘", "â•‘  explain - Mini-cours permissions         â•‘", "â•‘  mission - Revoir l'Ã©noncÃ©                â•‘", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"] },
      explain: { response: ["ğŸ“– PERMISSIONS LINUX", "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", "Format : -rwxrwxrwx = type|owner|group|others", "  r=4 (read) w=2 (write) x=1 (execute)", "", "Notation octale :", "  7 = rwx  6 = rw-  5 = r-x  4 = r--", "  3 = -wx  2 = -w-  1 = --x  0 = ---", "", "chmod 755 file â†’ rwxr-xr-x", "chmod 644 file â†’ rw-r--r--", "chmod 700 file â†’ rwx------", "", "chown user:group file â€” Changer le propriÃ©taire", "chgrp group file â€” Changer le groupe", "", "Principe du moindre privilÃ¨ge :", "  Donner le MINIMUM de droits nÃ©cessaires."] },
    },
    checkWin: (input) => perms.a(input),
    winResponse: [perms.win],
    defaultResponse: (input) => {
      if (/^chmod/i.test(input)) return ["âœ— VÃ©rifiez les valeurs octales ou symboliques.", "  Tapez 'hint' pour un indice."];
      return null;
    },
  };
};

const generateGrepLevel = () => {
  const s = pick([
    { q: "Le fichier '/var/log/auth.log' contient des milliers de lignes.\nRecherchez toutes les lignes contenant 'Failed password'.", a: (cmd) => /^grep\s+['"]?failed\s*password['"]?\s+\/var\/log\/auth\.log/i.test(cmd), win: "âœ“ grep 'Failed password' /var/log/auth.log â€” 47 tentatives Ã©chouÃ©es trouvÃ©es ! Possible brute force ?", hint: "grep 'motif' fichier" },
    { q: "Comptez le nombre de lignes contenant 'ERROR' dans le fichier 'app.log'.", a: (cmd) => /^grep\s+-c\s+['"]?error['"]?\s+app\.log/i.test(cmd) || /^grep\s+['"]?error['"]?\s+app\.log\s*\|\s*wc\s+-l/i.test(cmd), win: "âœ“ grep -c 'ERROR' app.log â†’ 156 erreurs. L'option -c compte les occurrences !", hint: "grep -c pour compter, ou grep ... | wc -l" },
  ]);
  return {
    id: "grep", title: "GREP & RECHERCHE",
    mission: `ğŸ“‹ MISSION :\n${s.q}\n\nTapez la commande appropriÃ©e.`,
    hint: s.hint, topic: "Grep, Pipes & Filtres",
    commands: {
      help: { response: ["â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—", "â•‘  Tapez votre commande grep                â•‘", "â•‘  hint    - Obtenir un indice              â•‘", "â•‘  explain - Mini-cours grep & pipes        â•‘", "â•‘  mission - Revoir l'Ã©noncÃ©                â•‘", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"] },
      explain: { response: ["ğŸ“– GREP & PIPES", "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", "grep 'motif' fichier â€” Rechercher un texte", "  -i  insensible Ã  la casse", "  -r  rÃ©cursif (dans les sous-dossiers)", "  -c  compter les occurrences", "  -n  afficher les numÃ©ros de ligne", "  -v  inverser (lignes qui NE contiennent PAS)", "", "Pipes (|) â€” ChaÃ®ner des commandes :", "  cat fichier | grep 'erreur' | wc -l", "  ps aux | grep nginx", "  ls -la | sort -k5 -n | tail -5", "", "Autres filtres :", "  sort â€” trier", "  uniq â€” dÃ©dupliquer", "  wc -l â€” compter les lignes", "  cut -d: -f1 â€” extraire des colonnes", "  awk '{print $1}' â€” traitement avancÃ©"] },
    },
    checkWin: (input) => s.a(input),
    winResponse: [s.win],
    defaultResponse: (input) => {
      if (/^grep/i.test(input)) return ["âœ— VÃ©rifiez la syntaxe grep et les options.", "  Tapez 'hint' pour un indice."];
      return null;
    },
  };
};

const generateProcessLevel = () => {
  const s = pick([
    { q: "Un processus 'node' consomme 98% du CPU. Son PID est 4287.\nTuez ce processus immÃ©diatement.", a: (cmd) => /^kill\s+(-9\s+)?4287\s*$/i.test(cmd) || /^kill\s+-SIGKILL\s+4287/i.test(cmd), win: "âœ“ kill -9 4287 â€” Processus terminÃ© ! Le signal 9 (SIGKILL) force l'arrÃªt immÃ©diat.", hint: "kill -9 <PID> pour forcer l'arrÃªt" },
    { q: "Affichez la liste des processus en cours avec leur consommation CPU/RAM.", a: (cmd) => /^(top|htop|ps\s+aux)\s*$/i.test(cmd), win: "âœ“ Bien jouÃ© ! ps aux / top / htop â€” Les outils essentiels de monitoring.", hint: "ps aux, top ou htop â€” commandes de monitoring" },
  ]);
  return {
    id: "process", title: "GESTION DES PROCESSUS",
    mission: `ğŸ“‹ MISSION :\n${s.q}\n\nTapez la commande appropriÃ©e.`,
    hint: s.hint, topic: "Processus & Monitoring",
    commands: {
      help: { response: ["â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—", "â•‘  Tapez votre commande                     â•‘", "â•‘  hint    - Obtenir un indice              â•‘", "â•‘  explain - Mini-cours processus           â•‘", "â•‘  mission - Revoir l'Ã©noncÃ©                â•‘", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"] },
      explain: { response: ["ğŸ“– GESTION DES PROCESSUS", "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", "ps â€” Snapshot des processus", "  ps aux â€” Tous les processus (dÃ©taillÃ©)", "  ps -ef â€” Format complet", "", "top / htop â€” Monitoring en temps rÃ©el", "  Trier par CPU, RAM, etc.", "", "kill â€” Envoyer un signal", "  kill PID â€” SIGTERM (arrÃªt propre)", "  kill -9 PID â€” SIGKILL (arrÃªt forcÃ©)", "  kill -HUP PID â€” Recharger la config", "", "Autres :", "  bg/fg â€” ArriÃ¨re-plan / premier plan", "  nohup cmd & â€” Survive Ã  la dÃ©connexion", "  systemctl status/start/stop service"] },
    },
    checkWin: (input) => s.a(input),
    winResponse: [s.win],
    defaultResponse: () => null,
  };
};

const generateUserLevel = () => {
  const s = pick([
    { q: "CrÃ©ez un nouvel utilisateur 'stagiaire' sur le systÃ¨me.", a: (cmd) => /^(sudo\s+)?(useradd|adduser)\s+stagiaire/i.test(cmd), win: "âœ“ useradd stagiaire â€” Utilisateur crÃ©Ã© ! N'oubliez pas de dÃ©finir un mot de passe avec passwd.", hint: "useradd ou adduser + le nom" },
    { q: "Ajoutez l'utilisateur 'dev01' au groupe 'docker'.", a: (cmd) => /^(sudo\s+)?usermod\s+(-aG|--append\s+--groups)\s+docker\s+dev01/i.test(cmd), win: "âœ“ usermod -aG docker dev01 â€” L'option -aG AJOUTE le groupe sans supprimer les autres !", hint: "usermod -aG <groupe> <utilisateur>" },
  ]);
  return {
    id: "users", title: "GESTION DES UTILISATEURS",
    mission: `ğŸ“‹ MISSION :\n${s.q}\n\nTapez la commande appropriÃ©e.`,
    hint: s.hint, topic: "Utilisateurs & Groupes",
    commands: {
      help: { response: ["â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—", "â•‘  Tapez votre commande                     â•‘", "â•‘  hint    - Obtenir un indice              â•‘", "â•‘  explain - Mini-cours utilisateurs        â•‘", "â•‘  mission - Revoir l'Ã©noncÃ©                â•‘", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"] },
      explain: { response: ["ğŸ“– UTILISATEURS & GROUPES", "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", "useradd user â€” CrÃ©er un utilisateur", "userdel user â€” Supprimer", "passwd user â€” DÃ©finir le mot de passe", "usermod -aG group user â€” Ajouter au groupe", "  âš  -a = append (IMPORTANT, sinon Ã©crase !)", "", "groups user â€” Voir les groupes d'un user", "id user â€” Voir UID, GID, groupes", "", "Fichiers clÃ©s :", "  /etc/passwd â€” Liste des utilisateurs", "  /etc/shadow â€” Mots de passe hashÃ©s", "  /etc/group â€” Liste des groupes", "", "sudo â€” ExÃ©cuter en tant que root", "  sudo commande", "  sudo -u user commande â€” En tant qu'un autre user"] },
    },
    checkWin: (input) => s.a(input),
    winResponse: [s.win],
    defaultResponse: () => null,
  };
};

const generateDiskLevel = () => {
  const s = pick([
    { q: "Affichez l'espace disque utilisÃ© sur toutes les partitions montÃ©es.", a: (cmd) => /^df\s+(-h)?\s*$/i.test(cmd), win: "âœ“ df -h â€” Disk Free ! Le -h rend les tailles lisibles (Go, Mo). /dev/sda1 : 78% utilisÃ©.", hint: "df = Disk Free. Ajoutez -h pour des tailles lisibles." },
    { q: "Trouvez les 5 plus gros fichiers dans /var/log.", a: (cmd) => /^(du|find|ls)/i.test(cmd) && /(sort|head|tail)/i.test(cmd), win: "âœ“ du -sh /var/log/* | sort -rh | head -5 â€” syslog fait 2.3Go, time to rotate !", hint: "du pour la taille + sort + head pour le top 5" },
  ]);
  return {
    id: "disk", title: "ESPACE DISQUE",
    mission: `ğŸ“‹ MISSION :\n${s.q}\n\nTapez la commande appropriÃ©e.`,
    hint: s.hint, topic: "Stockage & Disques",
    commands: {
      help: { response: ["â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—", "â•‘  Tapez votre commande                     â•‘", "â•‘  hint    - Obtenir un indice              â•‘", "â•‘  explain - Mini-cours disque              â•‘", "â•‘  mission - Revoir l'Ã©noncÃ©                â•‘", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"] },
      explain: { response: ["ğŸ“– GESTION DU STOCKAGE", "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", "df -h â€” Espace libre par partition", "du -sh dossier â€” Taille d'un dossier", "du -sh * | sort -rh | head -10 â€” Top 10", "", "lsblk â€” Liste des disques/partitions", "mount â€” Monter un disque", "umount â€” DÃ©monter", "fdisk -l â€” Info partitions", "", "Nettoyage :", "  journalctl --vacuum-size=100M", "  apt clean / apt autoremove", "  find /tmp -mtime +30 -delete", "", "âš  Un disque plein = serveur en panne !"] },
    },
    checkWin: (input) => s.a(input),
    winResponse: [s.win],
    defaultResponse: () => null,
  };
};

const generateCronLevel = () => {
  const s = {
    q: "Vous devez planifier un backup automatique : exÃ©cuter '/scripts/backup.sh' tous les jours Ã  2h du matin.\n\nÃ‰crivez la ligne crontab correspondante.",
    a: (cmd) => /^0\s+2\s+\*\s+\*\s+\*\s+\/scripts\/backup\.sh\s*$/i.test(cmd),
    win: "âœ“ 0 2 * * * /scripts/backup.sh â€” Backup planifiÃ© Ã  02:00 chaque jour !",
    hint: "Format cron : minute heure jour mois jour_semaine commande. 2h du matin = 0 2 * * *",
  };
  return {
    id: "cron", title: "CRON & AUTOMATISATION",
    mission: `ğŸ“‹ MISSION :\n${s.q}`,
    hint: s.hint, topic: "Crontab & Scheduling",
    commands: {
      help: { response: ["â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—", "â•‘  Tapez votre ligne crontab                â•‘", "â•‘  hint    - Obtenir un indice              â•‘", "â•‘  explain - Mini-cours crontab             â•‘", "â•‘  mission - Revoir l'Ã©noncÃ©                â•‘", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"] },
      explain: { response: ["ğŸ“– CRONTAB", "â”â”â”â”â”â”â”â”â”â”", "Format : min heure jour mois jour_sem commande", "  â”Œâ”€â”€â”€â”€â”€ minute (0-59)", "  â”‚ â”Œâ”€â”€â”€â”€â”€ heure (0-23)", "  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€ jour du mois (1-31)", "  â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€ mois (1-12)", "  â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€ jour semaine (0-7, 0/7=dim)", "  â”‚ â”‚ â”‚ â”‚ â”‚", "  * * * * * commande", "", "Exemples :", "  0 2 * * * â†’ Tous les jours Ã  2h", "  */15 * * * * â†’ Toutes les 15 minutes", "  0 0 1 * * â†’ 1er de chaque mois", "  0 9 * * 1-5 â†’ Lun-Ven Ã  9h", "", "crontab -e â€” Ã‰diter", "crontab -l â€” Lister"] },
    },
    checkWin: (input) => s.a(input),
    winResponse: [s.win],
    defaultResponse: (input) => {
      if (/^\d/.test(input) || /^\*/.test(input)) return ["âœ— VÃ©rifiez le format : minute heure jour mois jour_semaine commande", "  Tapez 'hint' pour un indice."];
      return null;
    },
  };
};

const generateNetworkLinuxLevel = () => {
  const s = pick([
    { q: "Affichez toutes les interfaces rÃ©seau et leurs adresses IP.", a: (cmd) => /^(ip\s+a(ddr)?|ifconfig)\s*$/i.test(cmd), win: "âœ“ ip a â€” eth0: 192.168.1.42/24, lo: 127.0.0.1. ip a remplace ifconfig sur les systÃ¨mes modernes.", hint: "ip a (ou ifconfig sur les anciens systÃ¨mes)" },
    { q: "VÃ©rifiez quels ports sont en Ã©coute sur le serveur.", a: (cmd) => /^(ss\s+-tlnp|netstat\s+-tlnp|ss\s+-tunlp|netstat\s+-tunlp)/i.test(cmd), win: "âœ“ ss -tlnp â€” Port 22 (SSH), 80 (Nginx), 3306 (MySQL) en Ã©coute. Tout est normal.", hint: "ss -tlnp ou netstat -tlnp â€” t=TCP, l=listening, n=numeric, p=process" },
  ]);
  return {
    id: "netlinux", title: "RÃ‰SEAU LINUX",
    mission: `ğŸ“‹ MISSION :\n${s.q}\n\nTapez la commande appropriÃ©e.`,
    hint: s.hint, topic: "Configuration RÃ©seau",
    commands: {
      help: { response: ["â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—", "â•‘  Tapez votre commande                     â•‘", "â•‘  hint    - Obtenir un indice              â•‘", "â•‘  explain - Mini-cours rÃ©seau Linux        â•‘", "â•‘  mission - Revoir l'Ã©noncÃ©                â•‘", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"] },
      explain: { response: ["ğŸ“– RÃ‰SEAU LINUX", "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", "ip a â€” Interfaces & adresses IP", "ip route â€” Table de routage", "ss -tlnp â€” Ports en Ã©coute (remplace netstat)", "ping host â€” Test de connectivitÃ©", "traceroute host â€” Chemin rÃ©seau", "dig/nslookup â€” RÃ©solution DNS", "curl URL â€” RequÃªte HTTP", "wget URL â€” TÃ©lÃ©charger un fichier", "", "Fichiers config :", "  /etc/hosts â€” DNS local", "  /etc/resolv.conf â€” Serveurs DNS", "  /etc/network/interfaces â€” Config rÃ©seau (Debian)", "  /etc/netplan/ â€” Config rÃ©seau (Ubuntu rÃ©cent)"] },
    },
    checkWin: (input) => s.a(input),
    winResponse: [s.win],
    defaultResponse: () => null,
  };
};

const generateServiceLevel = () => {
  const s = pick([
    { q: "Le service 'nginx' ne rÃ©pond plus. RedÃ©marrez-le.", a: (cmd) => /^(sudo\s+)?systemctl\s+restart\s+nginx/i.test(cmd), win: "âœ“ systemctl restart nginx â€” Service redÃ©marrÃ© ! VÃ©rifiez avec systemctl status nginx.", hint: "systemctl restart <service>" },
    { q: "Configurez le service 'docker' pour qu'il dÃ©marre automatiquement au boot.", a: (cmd) => /^(sudo\s+)?systemctl\s+enable\s+docker/i.test(cmd), win: "âœ“ systemctl enable docker â€” Docker dÃ©marrera automatiquement Ã  chaque reboot !", hint: "systemctl enable <service> pour le dÃ©marrage automatique" },
  ]);
  return {
    id: "service", title: "SERVICES & SYSTEMD",
    mission: `ğŸ“‹ MISSION :\n${s.q}\n\nTapez la commande appropriÃ©e.`,
    hint: s.hint, topic: "Systemctl & Services",
    commands: {
      help: { response: ["â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—", "â•‘  Tapez votre commande systemctl           â•‘", "â•‘  hint    - Obtenir un indice              â•‘", "â•‘  explain - Mini-cours systemd             â•‘", "â•‘  mission - Revoir l'Ã©noncÃ©                â•‘", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"] },
      explain: { response: ["ğŸ“– SYSTEMD & SERVICES", "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", "systemctl status service â€” Ã‰tat", "systemctl start service â€” DÃ©marrer", "systemctl stop service â€” ArrÃªter", "systemctl restart service â€” RedÃ©marrer", "systemctl enable service â€” Auto au boot", "systemctl disable service â€” DÃ©sactiver auto", "", "journalctl -u service â€” Logs du service", "journalctl -f â€” Suivre les logs en temps rÃ©el", "", "Services courants :", "  nginx, apache2 â€” Web", "  mysql, postgresql â€” BDD", "  ssh â€” AccÃ¨s distant", "  docker â€” Conteneurs", "  cron â€” TÃ¢ches planifiÃ©es"] },
    },
    checkWin: (input) => s.a(input),
    winResponse: [s.win],
    defaultResponse: (input) => {
      if (/^(sudo\s+)?systemctl/i.test(input)) return ["âœ— VÃ©rifiez l'action (start/stop/restart/enable).", "  Tapez 'hint' pour un indice."];
      return null;
    },
  };
};

const generateShellScriptLevel = () => {
  const s = {
    q: "ComplÃ©tez cette commande one-liner : trouver tous les fichiers .log de plus de 100Mo dans /var et les supprimer.\n\nTapez la commande 'find' appropriÃ©e.",
    a: (cmd) => /^find\s+\/var\s+.*-name\s+['"]\*\.log['"]\s+.*-size\s+\+100M/i.test(cmd) && /-delete|xargs\s+rm|exec\s+rm/i.test(cmd),
    win: "âœ“ find /var -name '*.log' -size +100M -delete â€” 3 fichiers supprimÃ©s, 4.7Go libÃ©rÃ©s !",
    hint: "find /var -name '*.log' -size +100M -delete",
  };
  return {
    id: "shell", title: "FIND & ONE-LINERS",
    mission: `ğŸ“‹ MISSION :\n${s.q}`,
    hint: s.hint, topic: "Shell AvancÃ©",
    commands: {
      help: { response: ["â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—", "â•‘  Tapez votre commande find                â•‘", "â•‘  hint    - Obtenir un indice              â•‘", "â•‘  explain - Mini-cours find                â•‘", "â•‘  mission - Revoir l'Ã©noncÃ©                â•‘", "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"] },
      explain: { response: ["ğŸ“– FIND â€” RECHERCHE AVANCÃ‰E", "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”", "find chemin [options] [action]", "", "Filtres :", "  -name '*.log' â€” Par nom (glob)", "  -type f/d â€” Fichier ou dossier", "  -size +100M â€” Plus de 100Mo", "  -mtime -7 â€” ModifiÃ© il y a <7 jours", "  -user alice â€” Appartenant Ã  alice", "  -perm 777 â€” Permissions exactes", "", "Actions :", "  -print â€” Afficher (dÃ©faut)", "  -delete â€” Supprimer", "  -exec cmd {} \\; â€” ExÃ©cuter une commande", "  | xargs cmd â€” Passer en argument", "", "Exemple : find / -name '*.tmp' -mtime +30 -delete"] },
    },
    checkWin: (input) => s.a(input),
    winResponse: [s.win],
    defaultResponse: (input) => {
      if (/^find/i.test(input)) return ["âœ— VÃ©rifiez les options -name, -size et l'action -delete.", "  Tapez 'hint' pour un indice."];
      return null;
    },
  };
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROFILES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const PROFILES = {
  "dÃ©butant": {
    label: "ğŸŸ¢ DÃ‰BUTANT", desc: "LycÃ©en / PremiÃ¨re fois sur Linux", color: "#84cc16",
    levels: () => [generateNavigationLevel(), generateFileOpsLevel(), generatePermissionsLevel(), generateGrepLevel(), generateProcessLevel()],
  },
  "intermÃ©diaire": {
    label: "ğŸŸ¡ INTERMÃ‰DIAIRE", desc: "Ã‰tudiant IT / Bac+2", color: "#facc15",
    levels: () => [generateNavigationLevel(), generateFileOpsLevel(), generatePermissionsLevel(), generateGrepLevel(), generateProcessLevel(), generateUserLevel(), generateDiskLevel()],
  },
  "expert": {
    label: "ğŸ”´ EXPERT", desc: "M1/M2 / Sysadmin", color: "#f87171",
    levels: () => [generateNavigationLevel(), generateFileOpsLevel(), generatePermissionsLevel(), generateGrepLevel(), generateProcessLevel(), generateUserLevel(), generateDiskLevel(), generateCronLevel(), generateNetworkLinuxLevel(), generateServiceLevel(), generateShellScriptLevel()],
  },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TERMINAL RAIN ANIMATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const TermRain = () => {
  const canvasRef = useRef(null);
  useEffect(() => {
    const canvas = canvasRef.current; if (!canvas) return;
    const ctx = canvas.getContext("2d");
    const resize = () => { canvas.width = canvas.parentElement.offsetWidth; canvas.height = canvas.parentElement.offsetHeight; };
    resize();
    const chars = "$ sudo apt chmod grep find ls cd cat rm cp mv mkdir df du ps kill top ssh scp rsync cron bash /etc /var /home root user";
    const fontSize = 14;
    const columns = Math.floor(canvas.width / fontSize);
    const drops = Array(columns).fill(1);
    const draw = () => {
      ctx.fillStyle = "rgba(0,0,0,0.04)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.font = fontSize + "px monospace";
      for (let i = 0; i < drops.length; i++) {
        const c = chars[Math.floor(Math.random() * chars.length)];
        ctx.globalAlpha = Math.random() * 0.25 + 0.05;
        ctx.fillStyle = pick(["#84cc16", "#a3e635", "#bef264", "#d9f99d"]);
        ctx.fillText(c, i * fontSize, drops[i] * fontSize);
        if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
        drops[i]++;
      }
      ctx.globalAlpha = 1;
    };
    const interval = setInterval(draw, 55);
    window.addEventListener("resize", resize);
    return () => { clearInterval(interval); window.removeEventListener("resize", resize); };
  }, []);
  return <canvas ref={canvasRef} style={{ position: "absolute", top: 0, left: 0, width: "100%", height: "100%", opacity: 0.12, pointerEvents: "none" }} />;
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN GAME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function LinuxGame() {
  const [screen, setScreen] = useState("menu");
  const [profile, setProfile] = useState(null);
  const [levels, setLevels] = useState([]);
  const [levelIdx, setLevelIdx] = useState(0);
  const [lines, setLines] = useState([]);
  const [input, setInput] = useState("");
  const [hintsUsed, setHintsUsed] = useState(0);
  const [startTime, setStartTime] = useState(null);
  const [playerName, setPlayerName] = useState("");
  const [leaderboard, setLeaderboard] = useState([]);
  const termRef = useRef(null);
  const inputRef = useRef(null);

  const scrollToBottom = useCallback(() => { if (termRef.current) setTimeout(() => { termRef.current.scrollTop = termRef.current.scrollHeight; }, 50); }, []);
  useEffect(() => { scrollToBottom(); }, [lines, scrollToBottom]);
  const addLines = (newLines, type) => { type = type || "response"; setLines((prev) => [...prev, ...newLines.map((text) => ({ type, text }))]); };

  const startGame = (profileKey) => {
    const gen = PROFILES[profileKey].levels();
    setProfile(profileKey); setLevels(gen); setLevelIdx(0); setHintsUsed(0); setStartTime(Date.now());
    setLines([
      { type: "system", text: "â•â•â•â•â•â• NIVEAU 1/" + gen.length + " : " + gen[0].title + " â•â•â•â•â•â•" },
      { type: "system", text: "ğŸ§ " + gen[0].topic },
      { type: "mission", text: gen[0].mission },
      { type: "empty", text: "" },
    ]);
    setScreen("game");
  };

  const advanceLevel = () => {
    if (levelIdx < levels.length - 1) {
      const next = levelIdx + 1; setLevelIdx(next);
      setTimeout(() => { addLines(["", "â•â•â•â•â•â• NIVEAU " + (next + 1) + "/" + levels.length + " : " + levels[next].title + " â•â•â•â•â•â•", "ğŸ§ " + levels[next].topic], "system"); addLines([levels[next].mission], "mission"); addLines([""], "empty"); }, 800);
    } else { setTimeout(() => setScreen("victory"), 1000); }
  };

  const handleCommand = (cmd) => {
    const original = cmd.trim(); const trimmed = original.toLowerCase(); if (!trimmed) return;
    setLines((prev) => [...prev, { type: "input", text: "user@srv:~$ " + original }]);
    if (trimmed === "clear") { setLines([]); return; }
    if (trimmed === "mission") { addLines([levels[levelIdx].mission], "mission"); return; }
    if (trimmed === "hint") { setHintsUsed((h) => h + 1); addLines(["ğŸ’¡ " + levels[levelIdx].hint], "hint"); return; }
    if (trimmed === "score") { const e = Math.floor((Date.now() - startTime) / 1000); addLines(["Niveau: " + (levelIdx + 1) + "/" + levels.length + " | Hints: " + hintsUsed + " | Temps: " + Math.floor(e / 60) + "m" + String(e % 60).padStart(2, "0") + "s"], "system"); return; }

    const cl = levels[levelIdx];
    if (cl.checkWin && cl.checkWin(trimmed)) { if (cl.winResponse) addLines(cl.winResponse, "success"); advanceLevel(); return; }
    if (cl.commands[trimmed]) { const r = cl.commands[trimmed]; addLines(r.response, "response"); return; }
    if (cl.defaultResponse) { const r = cl.defaultResponse(trimmed); if (r) { addLines(r, "response"); return; } }
    addLines(["bash: " + original.split(" ")[0] + ": commande non reconnue. Tapez 'help'."], "error");
  };

  const handleKeyDown = (e) => { if (e.key === "Enter") { handleCommand(input); setInput(""); } };
  const focusInput = () => { if (inputRef.current) inputRef.current.focus(); };
  const getScore = () => { const e = Math.floor((Date.now() - startTime) / 1000); const base = { "dÃ©butant": 500, "intermÃ©diaire": 750, "expert": 1000 }[profile] || 500; return Math.max(0, base - hintsUsed * 50 - Math.floor(e / 15)); };

  if (screen === "menu") {
    return (
      <div style={{ minHeight: "100vh", background: "#0a0f0a", fontFamily: "'Fira Code','Cascadia Code',monospace", display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center", position: "relative", overflow: "hidden" }}>
        <TermRain />
        <div style={{ zIndex: 10, textAlign: "center", maxWidth: "700px", padding: "20px" }}>
          <div style={{ color: "#84cc1666", fontSize: "11px", letterSpacing: "8px", marginBottom: "16px" }}>Ã‰COLE IT VALENCIENNES</div>
          <h1 style={{ color: "#84cc16", fontSize: "36px", margin: "0 0 6px", textShadow: "0 0 30px rgba(132,204,22,0.4)", letterSpacing: "4px" }}>LINUX TERMINAL</h1>
          <div style={{ color: "#84cc1688", fontSize: "13px", letterSpacing: "5px", marginBottom: "40px" }}>MAÃTRISEZ LE SHELL</div>
          <div style={{ marginBottom: "30px" }}>
            <input value={playerName} onChange={(e) => setPlayerName(e.target.value)} placeholder="Votre pseudo (optionnel)" maxLength={20}
              style={{ background: "rgba(132,204,22,0.05)", border: "1px solid #1a3a0a", color: "#84cc16", padding: "10px 16px", fontSize: "14px", fontFamily: "inherit", textAlign: "center", borderRadius: "4px", outline: "none", width: "250px" }}
              onFocus={(e) => { e.target.style.borderColor = "#84cc16"; }} onBlur={(e) => { e.target.style.borderColor = "#1a3a0a"; }} />
          </div>
          <div style={{ color: "#888", fontSize: "13px", marginBottom: "24px", letterSpacing: "2px" }}>CHOISISSEZ VOTRE NIVEAU</div>
          <div style={{ display: "flex", gap: "16px", justifyContent: "center", flexWrap: "wrap" }}>
            {Object.entries(PROFILES).map(([key, p]) => (
              <button key={key} onClick={() => startGame(key)}
                style={{ background: "rgba(10,15,10,0.8)", border: "1px solid " + p.color + "33", color: p.color, padding: "20px 24px", fontFamily: "inherit", fontSize: "13px", cursor: "pointer", borderRadius: "4px", width: "200px", textAlign: "left", transition: "all 0.3s", boxShadow: "0 0 20px " + p.color + "11" }}
                onMouseOver={(e) => { e.currentTarget.style.borderColor = p.color; e.currentTarget.style.boxShadow = "0 0 30px " + p.color + "33"; }}
                onMouseOut={(e) => { e.currentTarget.style.borderColor = p.color + "33"; e.currentTarget.style.boxShadow = "0 0 20px " + p.color + "11"; }}>
                <div style={{ fontSize: "16px", marginBottom: "8px", fontWeight: "bold" }}>{p.label}</div>
                <div style={{ color: "#888", fontSize: "11px", lineHeight: "1.5" }}>{p.desc}</div>
                <div style={{ color: "#555", fontSize: "10px", marginTop: "8px" }}>{p.levels().length} niveaux</div>
              </button>
            ))}
          </div>
          {leaderboard.length > 0 && (<div style={{ marginTop: "40px", maxWidth: "400px", margin: "40px auto 0" }}><div style={{ color: "#84cc16", fontSize: "12px", letterSpacing: "2px", marginBottom: "12px" }}>ğŸ† LEADERBOARD</div>{leaderboard.slice(0, 8).map((e, i) => (<div key={i} style={{ display: "flex", justifyContent: "space-between", color: i === 0 ? "#84cc16" : "#666", fontSize: "12px", padding: "4px 0", borderBottom: "1px solid #111" }}><span>{i + 1}. {e.name}</span><span>{e.score} pts</span></div>))}</div>)}
        </div>
      </div>
    );
  }

  if (screen === "victory") {
    const elapsed = Math.floor((Date.now() - startTime) / 1000); const score = getScore(); const p = PROFILES[profile];
    return (
      <div style={{ minHeight: "100vh", background: "#0a0f0a", fontFamily: "'Fira Code',monospace", display: "flex", alignItems: "center", justifyContent: "center", position: "relative", overflow: "hidden" }}>
        <TermRain />
        <div style={{ zIndex: 10, textAlign: "center", padding: "50px", border: "1px solid " + p.color + "44", borderRadius: "8px", background: "rgba(10,15,10,0.9)", boxShadow: "0 0 60px " + p.color + "15" }}>
          <div style={{ fontSize: "48px", marginBottom: "16px" }}>ğŸ†</div>
          <h1 style={{ color: p.color, fontSize: "26px", margin: "0 0 6px", letterSpacing: "4px" }}>SYSADMIN MASTER</h1>
          <div style={{ color: "#555", fontSize: "12px", letterSpacing: "3px", marginBottom: "30px" }}>{p.label}</div>
          <div style={{ color: "#888", marginBottom: "30px", lineHeight: "2.2", fontSize: "14px" }}>
            <div>Niveaux : <span style={{ color: p.color }}>{levels.length}/{levels.length}</span></div>
            <div>Temps : <span style={{ color: p.color }}>{Math.floor(elapsed / 60)}m {String(elapsed % 60).padStart(2, "0")}s</span></div>
            <div>Indices : <span style={{ color: hintsUsed === 0 ? "#4ade80" : "#facc15" }}>{hintsUsed}</span></div>
            <div style={{ fontSize: "22px", marginTop: "8px" }}>Score : <span style={{ color: p.color }}>{score}</span></div>
          </div>
          <div style={{ color: "#475569", fontSize: "11px", marginBottom: "24px", maxWidth: "380px", lineHeight: "1.6" }}>{levels.map((l) => l.topic).join(" Â· ")}</div>
          <div style={{ display: "flex", gap: "12px", justifyContent: "center", flexWrap: "wrap" }}>
            <button onClick={() => { setLeaderboard((prev) => [...prev, { name: playerName || "Anonyme", score, profile: p.label }].sort((a, b) => b.score - a.score)); setScreen("menu"); }} style={{ background: p.color, color: "#0a0f0a", border: "none", padding: "12px 28px", fontFamily: "inherit", fontSize: "13px", fontWeight: "bold", cursor: "pointer", letterSpacing: "2px", borderRadius: "3px" }}>SAUVER & MENU</button>
            <button onClick={() => startGame(profile)} style={{ background: "transparent", color: p.color, border: "1px solid " + p.color, padding: "12px 28px", fontFamily: "inherit", fontSize: "13px", cursor: "pointer", letterSpacing: "2px", borderRadius: "3px" }}>REJOUER</button>
          </div>
        </div>
      </div>
    );
  }

  const p = PROFILES[profile];
  return (
    <div style={{ minHeight: "100vh", background: "#0a0f0a", fontFamily: "'Fira Code',monospace", display: "flex", flexDirection: "column", position: "relative" }} onClick={focusInput}>
      <div style={{ background: "#0f150f", borderBottom: "1px solid #1a2a1a", padding: "10px 16px", display: "flex", justifyContent: "space-between", alignItems: "center", flexWrap: "wrap", gap: "8px", zIndex: 10 }}>
        <div style={{ display: "flex", alignItems: "center", gap: "12px", flexWrap: "wrap" }}>
          <span style={{ color: "#84cc16", fontSize: "13px", fontWeight: "bold" }}>ğŸ§ LINUX TERMINAL</span>
          <span style={{ color: "#1a2a1a" }}>|</span>
          <span style={{ color: p.color, fontSize: "11px" }}>{p.label}</span>
          <span style={{ color: "#1a2a1a" }}>|</span>
          <span style={{ color: "#4ade80", fontSize: "11px" }}>{levels[levelIdx]?.title}</span>
        </div>
        <div style={{ display: "flex", gap: "10px", alignItems: "center" }}>
          {playerName && <span style={{ color: "#555", fontSize: "11px" }}>{playerName}</span>}
          <span style={{ color: "#555", fontSize: "11px" }}>LVL {levelIdx + 1}/{levels.length}</span>
          <div style={{ display: "flex", gap: "3px" }}>
            {levels.map((_, i) => (<div key={i} style={{ width: "7px", height: "7px", borderRadius: "50%", background: i < levelIdx ? "#4ade80" : i === levelIdx ? p.color : "#1a2a1a", boxShadow: i < levelIdx ? "0 0 4px #4ade80" : i === levelIdx ? "0 0 6px " + p.color : "none" }} />))}
          </div>
          <button onClick={() => setScreen("menu")} style={{ background: "none", border: "1px solid #1a2a1a", color: "#555", padding: "2px 8px", fontFamily: "inherit", fontSize: "10px", cursor: "pointer", borderRadius: "2px" }}>MENU</button>
        </div>
      </div>
      <div ref={termRef} style={{ flex: 1, overflowY: "auto", padding: "14px 16px", paddingBottom: "65px" }}>
        {lines.map((line, i) => {
          if (line.type === "empty") return <div key={i} style={{ height: "10px" }} />;
          const colors = { system: "#84cc16", input: "#e2e8f0", success: "#4ade80", error: "#f87171", hint: "#facc15", mission: "#94a3b8", response: "#7a9a78" };
          return <div key={i} style={{ color: colors[line.type] || "#7a9a78", fontSize: "13px", lineHeight: "1.7", whiteSpace: "pre-wrap", fontFamily: "inherit" }}>{line.text}</div>;
        })}
      </div>
      <div style={{ position: "fixed", bottom: 0, left: 0, right: 0, background: "#0f150f", borderTop: "1px solid #1a2a1a", padding: "10px 16px", display: "flex", alignItems: "center", gap: "8px", zIndex: 10 }}>
        <span style={{ color: "#84cc16", fontSize: "13px", fontWeight: "bold" }}>user@srv:~$</span>
        <input ref={inputRef} value={input} onChange={(e) => setInput(e.target.value)} onKeyDown={handleKeyDown} autoFocus placeholder="Tapez votre commande..."
          style={{ flex: 1, background: "transparent", border: "none", outline: "none", color: "#e2e8f0", fontSize: "14px", fontFamily: "inherit", caretColor: "#84cc16" }} />
        <span style={{ color: "#1a2a1a", fontSize: "10px" }}>ENTER â†µ</span>
      </div>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<LinuxGame />);

    </script>
</body>
</html>
