<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š Data & IA â€” Challenge Terminal</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone@7.24.0/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body, #root { height: 100%; width: 100%; }
    </style>
</head>
<body>
    <div id="root"></div>
    
const { useState, useEffect, useRef, useCallback } = React;

const PROFILES = {
  beginner: { label: "ğŸŸ¢ DÃ©butant", desc: "Data Analyst Junior", color: "#22c55e", levels: [0,1,2,3,4,5] },
  intermediate: { label: "ğŸŸ¡ IntermÃ©diaire", desc: "Data Scientist", color: "#f59e0b", levels: [0,1,2,3,4,5,6,7,8] },
  expert: { label: "ğŸ”´ Expert", desc: "ML Engineer", color: "#ef4444", levels: [0,1,2,3,4,5,6,7,8,9,10,11] },
};

const shuffle = (arr) => { const a = [...arr]; for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; };
const pickRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];

const buildLevels = () => {
  const typeQuestions = shuffle([
    { data: '["Alice", 28, "Paris", true]', q: "Quel type de structure est-ce ?", a: ["list","liste","array","tableau"], explain: "Une liste (ou array) est une collection ordonnÃ©e d'Ã©lÃ©ments de types variÃ©s." },
    { data: '{"nom": "Alice", "age": 28, "ville": "Paris"}', q: "Quel type de structure est-ce ?", a: ["dict","dictionnaire","dictionary","json","objet","object"], explain: "Un dictionnaire (dict) stocke des paires clÃ©-valeur. Format JSON = standard d'Ã©change de donnÃ©es." },
    { data: "nom,age,ville\nAlice,28,Paris\nBob,35,Lyon", q: "Quel format de fichier est-ce ?", a: ["csv"], explain: "CSV = Comma Separated Values. Format tabulaire simple, lisible par Excel, Pandas, etc." },
  ]);
  const tq = typeQuestions[0];

  const sqlQuestions = shuffle([
    { table: "TABLE clients (id, nom, age, ville, achats)\n  1 | Alice  | 28 | Paris | 12\n  2 | Bob    | 35 | Lyon  |  3\n  3 | Clara  | 22 | Paris | 27\n  4 | David  | 45 | Lille |  8", q: "Ã‰crivez une requÃªte pour obtenir les noms des clients de Paris.", a: ["select nom from clients where ville = 'paris'","select nom from clients where ville='paris'","select nom from clients where ville = \"paris\"","select nom from clients where ville=\"paris\""], explain: "SELECT <colonnes> FROM <table> WHERE <condition> â€” la base de toute requÃªte SQL." },
    { table: "TABLE produits (id, nom, prix, stock, categorie)\n  1 | Laptop  | 999 | 15 | Tech\n  2 | Clavier |  49 | 82 | Tech\n  3 | Cahier  |   5 | 200| Bureau\n  4 | Ã‰cran   | 350 |  7 | Tech", q: "Ã‰crivez une requÃªte pour compter les produits par catÃ©gorie.", a: ["select categorie, count(*) from produits group by categorie","select categorie,count(*) from produits group by categorie"], explain: "GROUP BY regroupe les lignes par valeur. COUNT(*) compte les lignes de chaque groupe." },
  ]);
  const sq = sqlQuestions[0];

  const cleanQuestions = shuffle([
    { dataset: "nom    | age  | salaire\nAlice  | 28   | 35000\nBob    | -5   | 42000\nClara  | 31   | NaN\nDavid  | 999  | 28000\n???    | 27   | 31000", q: "Combien de valeurs problÃ©matiques voyez-vous ? Tapez le nombre.", a: ["4"], problems: ["age = -5 (nÃ©gatif impossible)","salaire = NaN (valeur manquante)","age = 999 (outlier aberrant)","nom = ??? (donnÃ©e invalide)"], explain: "Le nettoyage de donnÃ©es = 80% du travail d'un data scientist." },
    { dataset: "email             | date_inscription | pays\nalice@mail.com    | 2024-01-15      | France\nbob@mail          | 15/01/2024      | france\nalice@mail.com    | 2024-01-15      | FR\nclara@mail.com    | 2024-13-01      | NULL", q: "Combien de problÃ¨mes de qualitÃ© voyez-vous ? Tapez le nombre.", a: ["5","6"], problems: ["bob@mail â€” email invalide","Formats de date incohÃ©rents","Doublon : alice@mail.com","Pays incohÃ©rent : France, france, FR","Date invalide : mois 13","NULL = valeur manquante"], explain: "QualitÃ© des donnÃ©es : cohÃ©rence des formats, doublons, validation, normalisation." },
  ]);
  const cq = cleanQuestions[0];

  const statQuestions = shuffle([
    { data: "Revenus mensuels (â‚¬) : 2100, 2300, 2200, 2400, 2100, 8500, 2300", q: "Quelle mesure de tendance centrale est la plus reprÃ©sentative ici : moyenne ou mÃ©diane ?", a: ["mediane","mÃ©diane","median"], explain: "La mÃ©diane (2300â‚¬) rÃ©siste aux outliers. La moyenne (3129â‚¬) est tirÃ©e vers le haut par 8500â‚¬." },
    { data: "Notes d'examen : 8, 12, 14, 15, 13, 11, 14, 9, 13, 12", q: "Quel est l'Ã©cart-type approximatif ? Tapez 'faible' (< 3) ou 'fort' (> 3).", a: ["faible"], explain: "L'Ã©cart-type â‰ˆ 2.1 â†’ dispersion faible, groupe homogÃ¨ne." },
  ]);
  const stq = statQuestions[0];

  const vizQuestions = shuffle([
    { scenario: "Vous voulez montrer l'Ã©volution du chiffre d'affaires mois par mois sur 2024.", q: "Quel type de graphique est le plus adaptÃ© ? (line/bar/pie/scatter)", a: ["line","ligne","line chart"], explain: "Line chart = Ã©volution temporelle. Bar = comparaison catÃ©gories. Pie = proportions. Scatter = corrÃ©lation." },
    { scenario: "Vous voulez comparer la rÃ©partition homme/femme dans 5 dÃ©partements.", q: "Quel type de graphique ? (line/bar/pie/scatter/stacked bar)", a: ["stacked bar","bar","stacked","bar chart"], explain: "Stacked bar chart = idÃ©al pour comparer des compositions entre catÃ©gories." },
  ]);
  const vq = vizQuestions[0];

  const splitQuestion = { scenario: "Vous avez 1000 lignes de donnÃ©es pour prÃ©dire si un client va churner.\nVous entraÃ®nez votre modÃ¨le sur les 1000 lignes.\nAccuracy sur ces donnÃ©es : 98%.\nAccuracy en production : 52%.", q: "Quel est le problÃ¨me principal ? Tapez le terme technique.", a: ["overfitting","sur-apprentissage","surapprentissage","overfit"], explain: "OVERFITTING = le modÃ¨le a mÃ©morisÃ© les donnÃ©es d'entraÃ®nement au lieu d'apprendre les patterns." };

  const metricQuestions = shuffle([
    { scenario: "DÃ©tection de fraude bancaire :\n  - 90 prÃ©dites Â« lÃ©gitimes Â» â†’ 85 vraies, 5 Ã©taient des fraudes\n  - 10 prÃ©dites Â« fraude Â» â†’ 8 vraies fraudes, 2 faux positifs", q: "Le recall (rappel) pour la classe 'fraude' est de combien ? (en %)", a: ["61","61%","62","62%"], explain: "Recall = 8 / (8+5) â‰ˆ 61.5%. En dÃ©tection de fraude, le recall est crucial." },
    { scenario: "Diagnostic mÃ©dical :\n  - 180 prÃ©dits sains â†’ 175 vrais, 5 avaient un cancer\n  - 20 prÃ©dits malades â†’ 15 vrais cancers, 5 faux positifs", q: "La prÃ©cision pour la classe 'cancer' est de combien ? (en %)", a: ["75","75%"], explain: "PrÃ©cision = 15 / (15+5) = 75%." },
  ]);
  const mq = metricQuestions[0];

  const feQuestions = shuffle([
    { dataset: "Pour prÃ©dire le prix d'un appartement :\n  surface_m2 | nb_pieces | adresse             | date_construction\n  65         | 3         | 12 rue Victor Hugo  | 1985\n  42         | 2         | 8 av des Champs     | 2010", q: "Quelle nouvelle feature pourriez-vous crÃ©er Ã  partir de 'adresse' pour le modÃ¨le ?", a: ["quartier","arrondissement","code postal","ville","zone","localisation","geolocalisation","latitude","longitude","coordonnees","district"], explain: "Feature engineering = crÃ©er de nouvelles variables utiles. Adresse brute â†’ quartier, code postal, ou lat/long." },
  ]);
  const feq = feQuestions[0];

  const algoQuestions = shuffle([
    { scenario: "Vous devez classer des emails en spam/pas spam.\nVous avez 50 000 emails labellisÃ©s.", q: "Quel type de problÃ¨me ML est-ce ? (classification/regression/clustering)", a: ["classification"], explain: "Classification = prÃ©dire une catÃ©gorie. RÃ©gression = valeur continue. Clustering = regrouper sans labels." },
    { scenario: "Vous avez 10 000 clients avec leurs comportements d'achat.\nPas de labels. Vous voulez identifier des segments.", q: "Quel type de problÃ¨me ML ? (classification/regression/clustering)", a: ["clustering"], explain: "Clustering = apprentissage non supervisÃ©. Algorithmes : K-Means, DBSCAN, hiÃ©rarchique." },
  ]);
  const aq = algoQuestions[0];

  const biasQuestions = shuffle([
    { scenario: "Un modÃ¨le de recrutement IA entraÃ®nÃ© sur 10 ans d'historique.\nL'entreprise a embauchÃ© 85% d'hommes.\nLe modÃ¨le obtient 92% d'accuracy.", q: "Quel est le risque principal ?", a: ["biais","bias","discrimination","biais de selection","biais historique","biais de genre"], explain: "BIAIS DE DONNÃ‰ES â†’ Le modÃ¨le reproduit les discriminations historiques." },
  ]);
  const bq = biasQuestions[0];

  const dlQuestions = shuffle([
    { scenario: "RÃ©seau de neurones :\n  Input: image 28x28 pixels\n  Hidden 1: 128 neurones, ReLU\n  Hidden 2: 64 neurones, ReLU\n  Output: 10 neurones, Softmax", q: "Pourquoi Softmax en sortie et pas ReLU ? (1 mot clÃ©)", a: ["probabilite","probabilites","probabilitÃ©","probabilitÃ©s","proba","distribution"], explain: "Softmax convertit les scores en probabilitÃ©s (somme = 1)." },
    { scenario: "CNN sur ImageNet :\nÃ‰poque 1: loss=4.2, accuracy=8%\nÃ‰poque 50: train_loss=0.3, train_acc=95%, val_loss=2.1, val_acc=62%", q: "Que se passe-t-il Ã  l'Ã©poque 50 ?", a: ["overfitting","sur-apprentissage","surapprentissage","overfit"], explain: "Train acc 95% mais val acc 62% = overfitting massif." },
  ]);
  const dlq = dlQuestions[0];

  const mlopsQuestions = shuffle([
    { scenario: "Votre modÃ¨le de recommandation en prod depuis 6 mois.\nPerf initiale : precision@10 = 0.42\nPerf actuelle : precision@10 = 0.28\nAucune modification du code.", q: "Quel phÃ©nomÃ¨ne explique cette dÃ©gradation ?", a: ["data drift","drift","concept drift","model drift","distribution shift","derive","dÃ©rive"], explain: "DATA DRIFT = les donnÃ©es rÃ©elles changent avec le temps." },
  ]);
  const mlq = mlopsQuestions[0];

  return [
    { id:0, title:"STRUCTURES DE DONNÃ‰ES", mission:"Identifiez la structure :\n\n  "+tq.data+"\n\n"+tq.q, hint:tq.explain.substring(0,60)+"...", topic:"Types & Structures", answers:tq.a, winResponse:["âœ“ CORRECT !","","ğŸ“– "+tq.explain], explain:["ğŸ“– STRUCTURES DE DONNÃ‰ES","â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”","â€¢ Liste/Array : [1, 2, 3]","â€¢ Dict/JSON : {\"nom\": \"Alice\"}","â€¢ CSV : tableau texte","â€¢ DataFrame : Pandas","â€¢ Parquet : colonnaire Big Data"] },
    { id:1, title:"SQL â€” REQUÃŠTES", mission:"Table :\n\n  "+sq.table+"\n\n"+sq.q, hint:sq.explain.substring(0,80)+"...", topic:"SQL", answers:sq.a, winResponse:["âœ“ REQUÃŠTE VALIDE !","","ğŸ“– "+sq.explain], explain:["ğŸ“– SQL","â”â”â”â”â”â”","SELECT FROM WHERE","GROUP BY, ORDER BY","JOIN, HAVING","AgrÃ©gats : COUNT, SUM, AVG, MIN, MAX"] },
    { id:2, title:"NETTOYAGE DE DONNÃ‰ES", mission:"Analysez :\n\n  "+cq.dataset+"\n\n"+cq.q, hint:"Cherchez : NaN, valeurs nÃ©gatives, outliers, donnÃ©es invalides.", topic:"Data Cleaning", answers:cq.a, winResponse:["âœ“ BON OEIL !","","ProblÃ¨mes :",...cq.problems.map(function(p){return "  âš  "+p;}),"","ğŸ“– "+cq.explain], explain:["ğŸ“– NETTOYAGE","â”â”â”â”â”â”â”â”â”â”â”â”","VÃ©rifier :","  â€¢ Valeurs manquantes (NaN, NULL)","  â€¢ Outliers (IQR, z-score)","  â€¢ Doublons","  â€¢ Types incorrects","  â€¢ CohÃ©rence des formats"] },
    { id:3, title:"STATISTIQUES DESCRIPTIVES", mission:stq.data+"\n\n"+stq.q, hint:"Pensez Ã  l'impact des valeurs extrÃªmes.", topic:"Statistiques", answers:stq.a, winResponse:["âœ“ EXACT !","","ğŸ“– "+stq.explain], explain:["ğŸ“– STATS","â”â”â”â”â”â”â”â”","Tendance : moyenne, mÃ©diane, mode","Dispersion : Ã©cart-type, variance, IQR","MÃ©diane > Moyenne quand outliers"] },
    { id:4, title:"DATA VISUALISATION", mission:vq.scenario+"\n\n"+vq.q, hint:"Chaque graphique a un usage optimal.", topic:"Visualisation", answers:vq.a, winResponse:["âœ“ BON CHOIX !","","ğŸ“– "+vq.explain], explain:["ğŸ“– GRAPHIQUES","â”â”â”â”â”â”â”â”â”â”â”â”â”","ğŸ“ˆ Line â†’ temps","ğŸ“Š Bar â†’ catÃ©gories","ğŸ¥§ Pie â†’ proportions","âš« Scatter â†’ corrÃ©lation"] },
    { id:5, title:"TRAIN / TEST SPLIT", mission:splitQuestion.scenario+"\n\n"+splitQuestion.q, hint:"Quand un modÃ¨le performe bien en entraÃ®nement mais mal en rÃ©alitÃ©...", topic:"Overfitting", answers:splitQuestion.a, winResponse:["âœ“ EXACTEMENT !","","ğŸ“– "+splitQuestion.explain,"","RÃ¨gle d'or : JAMAIS Ã©valuer sur les donnÃ©es d'entraÃ®nement."], explain:["ğŸ“– OVERFITTING","â”â”â”â”â”â”â”â”â”â”â”â”â”â”","Overfitting : mÃ©morise le bruit","Underfitting : trop simple","Solutions : train/test split, cross-validation, rÃ©gularisation"] },
    { id:6, title:"MÃ‰TRIQUES ML", mission:mq.scenario+"\n\n"+mq.q, hint:"Recall = TP / (TP + FN). PrÃ©cision = TP / (TP + FP).", topic:"MÃ©triques", answers:mq.a, winResponse:["âœ“ BIEN CALCULÃ‰ !","","ğŸ“– "+mq.explain], explain:["ğŸ“– MÃ‰TRIQUES","â”â”â”â”â”â”â”â”â”â”â”â”","Accuracy = (TP+TN) / Total","PrÃ©cision = TP / (TP+FP)","Recall = TP / (TP+FN)","F1 = 2Ã—(PÃ—R)/(P+R)"] },
    { id:7, title:"FEATURE ENGINEERING", mission:feq.dataset+"\n\n"+feq.q, hint:"Comment transformer une donnÃ©e brute en info utile ?", topic:"Feature Engineering", answers:feq.a, winResponse:["âœ“ BONNE INTUITION !","","ğŸ“– "+feq.explain], explain:["ğŸ“– FEATURE ENGINEERING","â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”","Extraction, Encoding, AgrÃ©gation","\"Garbage in, garbage out\""] },
    { id:8, title:"ALGORITHMES ML", mission:aq.scenario+"\n\n"+aq.q, hint:"SupervisÃ© = avec labels. Non supervisÃ© = sans labels.", topic:"Algorithmes", answers:aq.a, winResponse:["âœ“ CORRECT !","","ğŸ“– "+aq.explain], explain:["ğŸ“– TYPES DE ML","â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”","SUPERVISÃ‰ : Classification, RÃ©gression","NON SUPERVISÃ‰ : Clustering, PCA","RENFORCEMENT : agent + rÃ©compense"] },
    { id:9, title:"BIAIS & Ã‰THIQUE IA", mission:bq.scenario+"\n\n"+bq.q, hint:"Le modÃ¨le apprend de ce qu'on lui donne.", topic:"Ã‰thique IA", answers:bq.a, winResponse:["âœ“ CRUCIAL !","","ğŸ“– "+bq.explain], explain:["ğŸ“– BIAIS EN IA","â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”","Biais de sÃ©lection, historique, confirmation","Solutions : audit, donnÃ©es diversifiÃ©es, SHAP, AI Act"] },
    { id:10, title:"DEEP LEARNING", mission:dlq.scenario+"\n\n"+dlq.q, hint:"Pensez Ã  ce que la couche de sortie doit produire.", topic:"Deep Learning", answers:dlq.a, winResponse:["âœ“ EXACT !","","ğŸ“– "+dlq.explain], explain:["ğŸ“– DEEP LEARNING","â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”","MLP, CNN, RNN/LSTM, Transformer","ReLU â†’ couches cachÃ©es","Softmax â†’ classification multi-classes"] },
    { id:11, title:"MLOPS & PRODUCTION", mission:mlq.scenario+"\n\n"+mlq.q, hint:"Le monde rÃ©el change. Les donnÃ©es aussi.", topic:"MLOps", answers:mlq.a, winResponse:["âœ“ BIEN VU !","","ğŸ“– "+mlq.explain], explain:["ğŸ“– MLOPS","â”â”â”â”â”â”â”â”â”","Data â†’ Feature Store â†’ Train â†’ Deploy â†’ Monitor","Data drift, Concept drift, A/B testing","Outils : MLflow, Kubeflow, DVC"] },
  ];
};

function DataAIGame() {
  const [screen, setScreen] = useState("title");
  const [profile, setProfile] = useState(null);
  const [pseudo, setPseudo] = useState("");
  const [pseudoInput, setPseudoInput] = useState("");
  const [levels, setLevels] = useState([]);
  const [currentLevel, setCurrentLevel] = useState(0);
  const [lines, setLines] = useState([]);
  const [input, setInput] = useState("");
  const [score, setScore] = useState(0);
  const [startTime, setStartTime] = useState(null);
  const [hintsUsed, setHintsUsed] = useState(0);
  const [levelSolved, setLevelSolved] = useState(false);
  const [commandHistory, setCommandHistory] = useState([]);
  const [historyIndex, setHistoryIndex] = useState(-1);
  const termRef = useRef(null);
  const inputRef = useRef(null);
  const allLevels = useRef([]);

  useEffect(function() { allLevels.current = buildLevels(); }, []);

  const scrollToBottom = useCallback(function() { setTimeout(function() { if (termRef.current) termRef.current.scrollTop = termRef.current.scrollHeight; }, 20); }, []);
  const addLines = useCallback(function(newLines) { setLines(function(prev) { return prev.concat(newLines); }); scrollToBottom(); }, [scrollToBottom]);
  const focusInput = function() { if (inputRef.current) inputRef.current.focus(); };

  const startGame = function(prof) {
    allLevels.current = buildLevels();
    var profileLevels = PROFILES[prof].levels.map(function(i) { return allLevels.current[i]; });
    setProfile(prof); setLevels(profileLevels); setCurrentLevel(0); setScore(0); setHintsUsed(0); setStartTime(Date.now()); setLevelSolved(false); setCommandHistory([]); setHistoryIndex(-1);
    var lvl = profileLevels[0];
    setLines([
      "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”",
      "â”‚  DATA/IA TERMINAL â€” " + PROFILES[prof].label.padEnd(30) + "â”‚",
      "â”‚  Agent : " + pseudo.padEnd(42) + "â”‚",
      "â”‚  Niveaux : " + String(profileLevels.length).padEnd(40) + "â”‚",
      "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜",
      "",
      "â•â•â• NIVEAU 1/" + profileLevels.length + " : " + lvl.title + " â•â•â•",
      "ğŸ“¡ ThÃ¨me : " + lvl.topic,
      "", ...lvl.mission.split("\n"), "",
      "Tapez votre rÃ©ponse. Commandes : help | hint | explain | mission | skip",
    ]);
    setScreen("game");
    setTimeout(focusInput, 100);
  };

  const processCommand = function(cmd) {
    var trimmed = cmd.trim(); if (!trimmed) return;
    setCommandHistory(function(prev) { return prev.concat([trimmed]); }); setHistoryIndex(-1);
    var lower = trimmed.toLowerCase();
    var lvl = levels[currentLevel];
    var promptLine = "data[" + (currentLevel + 1) + "]> " + trimmed;

    if (lower === "help") { addLines([promptLine,"","â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—","â•‘           COMMANDES DISPONIBLES           â•‘","â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£","â•‘  help      - Cette aide                  â•‘","â•‘  hint      - Obtenir un indice (-50 pts) â•‘","â•‘  explain   - Mini-cours sur le thÃ¨me     â•‘","â•‘  mission   - Revoir l'Ã©noncÃ©             â•‘","â•‘  skip      - Passer au niveau suivant    â•‘","â•‘  score     - Score actuel                â•‘","â•‘  clear     - Nettoyer le terminal        â•‘","â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"]); return; }
    if (lower === "clear") { setLines(["â•â•â• NIVEAU " + (currentLevel+1) + "/" + levels.length + " : " + lvl.title + " â•â•â•","Tapez 'mission' pour revoir l'Ã©noncÃ©."]); return; }
    if (lower === "hint") { setHintsUsed(function(h){return h+1;}); setScore(function(s){return Math.max(0,s-50);}); addLines([promptLine,"","ğŸ’¡ INDICE : " + lvl.hint,"(-50 points)"]); return; }
    if (lower === "explain") { addLines([promptLine,""].concat(lvl.explain)); return; }
    if (lower === "mission") { addLines([promptLine,"","â•â•â• " + lvl.title + " â•â•â•"].concat(lvl.mission.split("\n"))); return; }
    if (lower === "score") { var elapsed = Math.floor((Date.now()-startTime)/1000); addLines([promptLine,"","ğŸ“Š Score : " + score + " pts","â±ï¸ Temps : " + Math.floor(elapsed/60) + "m " + (elapsed%60) + "s","ğŸ’¡ Hints : " + hintsUsed,"ğŸ“ˆ Niveau : " + (currentLevel+1) + "/" + levels.length]); return; }
    if (lower === "skip") { addLines([promptLine,"","â­ï¸ Niveau passÃ© (0 points)"]); goNextLevel(); return; }

    if (levelSolved) { addLines([promptLine,"âœ“ DÃ©jÃ  rÃ©solu ! Tapez 'skip' pour continuer."]); return; }

    var isCorrect = lvl.answers.some(function(a) { return lower === a.toLowerCase() || lower.includes(a.toLowerCase()); });
    if (isCorrect) {
      setScore(function(s){return s+100;}); setLevelSolved(true);
      addLines([promptLine,""].concat(lvl.winResponse).concat(["","  +100 points !","",currentLevel < levels.length-1 ? "â†’ Tapez n'importe quoi pour continuer..." : "â†’ Tapez 'finish' pour voir vos rÃ©sultats !"]));
      if (currentLevel < levels.length-1) setTimeout(function(){goNextLevel();}, 4000);
    } else {
      addLines([promptLine,"","âœ— Incorrect. RÃ©essayez !","  (tapez 'hint' pour un indice ou 'explain' pour un cours)"]);
    }
  };

  const goNextLevel = function() {
    var next = currentLevel + 1;
    if (next >= levels.length) {
      var elapsed = Math.floor((Date.now()-startTime)/1000); var bonus = Math.max(0,500-elapsed); var finalScore = score + bonus; setScore(finalScore);
      addLines(["","â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—","â•‘            ğŸ† MISSION TERMINÃ‰E !                â•‘","â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£","â•‘  Agent : " + pseudo.padEnd(38) + "â•‘","â•‘  Profil : " + PROFILES[profile].label.padEnd(36) + "â•‘","â•‘  Score : " + String(finalScore).padEnd(38) + "â•‘","â•‘  Temps : " + (Math.floor(elapsed/60) + "m " + (elapsed%60) + "s").padEnd(38) + "â•‘","â•‘  Hints : " + String(hintsUsed).padEnd(38) + "â•‘","â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","",finalScore > 800 ? "ğŸŒŸ EXCEPTIONNEL !" : finalScore > 500 ? "ğŸ‘ Solide !" : "ğŸ“š Pas mal !","","Tapez 'restart' pour rejouer ou 'menu' pour changer de profil."]);
      setScreen("win"); return;
    }
    setCurrentLevel(next); setLevelSolved(false);
    var lvl = levels[next];
    addLines(["","â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”","","â•â•â• NIVEAU " + (next+1) + "/" + levels.length + " : " + lvl.title + " â•â•â•","ğŸ“¡ ThÃ¨me : " + lvl.topic,""].concat(lvl.mission.split("\n")).concat(["","Tapez votre rÃ©ponse. Commandes : help | hint | explain"]));
  };

  const handleKey = function(e) {
    if (e.key === "Enter") {
      var cmd = input; setInput("");
      if (screen === "win") { if (cmd.toLowerCase() === "restart") { startGame(profile); return; } if (cmd.toLowerCase() === "menu") { setScreen("profile"); return; } }
      if (levelSolved && currentLevel < levels.length-1) { goNextLevel(); return; }
      if (levelSolved && currentLevel === levels.length-1 && cmd.toLowerCase() === "finish") { goNextLevel(); return; }
      processCommand(cmd);
    }
    if (e.key === "ArrowUp") { e.preventDefault(); if (commandHistory.length > 0) { var ni = historyIndex === -1 ? commandHistory.length-1 : Math.max(0,historyIndex-1); setHistoryIndex(ni); setInput(commandHistory[ni]); } }
    if (e.key === "ArrowDown") { e.preventDefault(); if (historyIndex === -1) return; var ni2 = historyIndex+1; if (ni2 >= commandHistory.length) { setHistoryIndex(-1); setInput(""); } else { setHistoryIndex(ni2); setInput(commandHistory[ni2]); } }
  };

  if (screen === "title") {
    return (
      <div style={{minHeight:"100vh",background:"linear-gradient(135deg, #0a0a1a 0%, #1a0a2e 50%, #0d1b2a 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"'JetBrains Mono','Fira Code','Courier New',monospace",padding:"20px"}}>
        <div style={{maxWidth:600,width:"100%",textAlign:"center"}}>
          <div style={{fontSize:"11px",color:"#6366f1",letterSpacing:"6px",marginBottom:12}}>Terminal Ã‰ducatif</div>
          <h1 style={{fontSize:"clamp(32px,6vw,56px)",fontWeight:900,margin:"0 0 8px 0",background:"linear-gradient(135deg,#818cf8,#c084fc,#f472b6)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",lineHeight:1.1}}>DATA / IA</h1>
          <div style={{fontSize:13,color:"#64748b",marginBottom:40,letterSpacing:"2px"}}>CHALLENGE</div>
          <div style={{background:"rgba(99,102,241,0.08)",border:"1px solid rgba(99,102,241,0.2)",borderRadius:12,padding:"24px",marginBottom:30,textAlign:"left"}}>
            <div style={{color:"#94a3b8",fontSize:12,lineHeight:1.8}}>
              <span style={{color:"#818cf8"}}>$</span> SQL, nettoyage, stats, ML, deep learning, Ã©thique<br/>
              <span style={{color:"#818cf8"}}>$</span> 3 profils : DÃ©butant â†’ IntermÃ©diaire â†’ Expert<br/>
              <span style={{color:"#818cf8"}}>$</span> Questions alÃ©atoires Ã  chaque partie
            </div>
          </div>
          <div style={{marginBottom:16}}>
            <input type="text" placeholder="Entrez votre pseudo..." value={pseudoInput} onChange={function(e){setPseudoInput(e.target.value);}} onKeyDown={function(e){if(e.key==="Enter"&&pseudoInput.trim()){setPseudo(pseudoInput.trim());setScreen("profile");}}} style={{width:"100%",maxWidth:320,padding:"12px 16px",background:"rgba(15,15,35,0.8)",border:"1px solid rgba(99,102,241,0.3)",borderRadius:8,color:"#e2e8f0",fontSize:14,fontFamily:"inherit",outline:"none",textAlign:"center"}} />
          </div>
          <button onClick={function(){if(pseudoInput.trim()){setPseudo(pseudoInput.trim());setScreen("profile");}}} disabled={!pseudoInput.trim()} style={{padding:"12px 40px",background:pseudoInput.trim()?"linear-gradient(135deg,#6366f1,#8b5cf6)":"rgba(99,102,241,0.2)",border:"none",borderRadius:8,color:pseudoInput.trim()?"#fff":"#64748b",fontSize:14,fontFamily:"inherit",cursor:pseudoInput.trim()?"pointer":"default",fontWeight:600,letterSpacing:"1px"}}>DÃ‰MARRER â†’</button>
        </div>
      </div>
    );
  }

  if (screen === "profile") {
    var topicsByLevel = { beginner:["Structures","SQL","Cleaning","Stats","Visualisation","Overfitting"], intermediate:["...DÃ©butant +","MÃ©triques ML","Feature Eng","Algorithmes"], expert:["...Inter +","Biais IA","Deep Learning","MLOps"] };
    return (
      <div style={{minHeight:"100vh",background:"linear-gradient(135deg,#0a0a1a 0%,#1a0a2e 50%,#0d1b2a 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"'JetBrains Mono','Fira Code','Courier New',monospace",padding:"20px"}}>
        <div style={{maxWidth:650,width:"100%"}}>
          <div style={{textAlign:"center",marginBottom:36}}><div style={{fontSize:11,color:"#6366f1",letterSpacing:4,marginBottom:8}}>AGENT : {pseudo}</div><h2 style={{fontSize:28,fontWeight:800,color:"#e2e8f0",margin:0}}>Choisissez votre profil</h2></div>
          <div style={{display:"flex",flexDirection:"column",gap:16}}>
            {Object.entries(PROFILES).map(function(entry) { var key=entry[0], p=entry[1]; return (
              <button key={key} onClick={function(){startGame(key);}} style={{display:"flex",alignItems:"flex-start",gap:20,padding:"20px 24px",background:"rgba(15,15,35,0.6)",border:"1px solid "+p.color+"33",borderRadius:12,cursor:"pointer",textAlign:"left",fontFamily:"inherit",transition:"all 0.2s"}} onMouseEnter={function(e){e.currentTarget.style.background=p.color+"15";e.currentTarget.style.borderColor=p.color+"66";}} onMouseLeave={function(e){e.currentTarget.style.background="rgba(15,15,35,0.6)";e.currentTarget.style.borderColor=p.color+"33";}}>
                <div style={{minWidth:50,height:50,borderRadius:10,background:p.color+"20",display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,flexShrink:0}}>{p.label.split(" ")[0]}</div>
                <div style={{flex:1}}>
                  <div style={{color:p.color,fontWeight:700,fontSize:15,marginBottom:2}}>{p.label.split(" ").slice(1).join(" ")} â€” {p.desc}</div>
                  <div style={{color:"#64748b",fontSize:11,marginBottom:8}}>{p.levels.length} niveaux</div>
                  <div style={{display:"flex",flexWrap:"wrap",gap:4}}>{topicsByLevel[key].map(function(t,i){return <span key={i} style={{fontSize:10,padding:"2px 8px",borderRadius:4,background:p.color+"15",color:p.color+"cc",border:"1px solid "+p.color+"22"}}>{t}</span>;})}</div>
                </div>
                <div style={{color:"#475569",fontSize:18,alignSelf:"center"}}>â†’</div>
              </button>
            );})}
          </div>
          <div style={{textAlign:"center",marginTop:24}}><button onClick={function(){setScreen("title");}} style={{background:"none",border:"none",color:"#475569",fontSize:12,cursor:"pointer",fontFamily:"inherit"}}>â† Retour</button></div>
        </div>
      </div>
    );
  }

  var lvl = levels[currentLevel];
  var prof = PROFILES[profile];

  return (
    <div style={{height:"100vh",display:"flex",flexDirection:"column",background:"#080818",fontFamily:"'JetBrains Mono','Fira Code','Courier New',monospace",overflow:"hidden"}} onClick={focusInput}>
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 16px",background:"rgba(99,102,241,0.08)",borderBottom:"1px solid rgba(99,102,241,0.15)",flexShrink:0,flexWrap:"wrap",gap:8}}>
        <div style={{display:"flex",alignItems:"center",gap:12}}>
          <span style={{fontSize:11,color:prof.color,fontWeight:700}}>{prof.label}</span>
          <span style={{color:"#475569",fontSize:11}}>â”‚</span>
          <span style={{color:"#94a3b8",fontSize:11}}>{pseudo}</span>
        </div>
        <div style={{display:"flex",alignItems:"center",gap:16}}>
          <span style={{color:"#818cf8",fontSize:11}}>ğŸ“Š {score} pts</span>
          <span style={{color:"#64748b",fontSize:11}}>ğŸ“¡ {currentLevel+1}/{levels.length}</span>
          <span style={{color:"#64748b",fontSize:11}}>{lvl && "["+lvl.topic+"]"}</span>
        </div>
      </div>
      <div ref={termRef} style={{flex:1,overflowY:"auto",padding:"16px",paddingBottom:80}}>
        {lines.map(function(line,i) { return <div key={i} style={{fontSize:12,lineHeight:1.7,color:line.startsWith("âœ“")?"#22c55e":line.startsWith("âœ—")?"#ef4444":line.startsWith("â•â•â•")?"#818cf8":line.startsWith("ğŸ“–")?"#c084fc":line.startsWith("ğŸ’¡")?"#f59e0b":line.startsWith("  âš ")?"#f97316":line.startsWith("â†’")?"#6366f1":line.startsWith("data[")?"#38bdf8":(line.includes("â•”")||line.includes("â•‘")||line.includes("â•š")||line.includes("â• "))?"#6366f1":line.startsWith("â”")?"#334155":"#94a3b8",whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"inherit"}}>{line || "\u00A0"}</div>; })}
      </div>
      <div style={{position:"sticky",bottom:0,display:"flex",alignItems:"center",padding:"12px 16px",background:"rgba(10,10,26,0.95)",borderTop:"1px solid rgba(99,102,241,0.15)",backdropFilter:"blur(8px)",flexShrink:0}}>
        <span style={{color:"#818cf8",fontSize:12,marginRight:8,flexShrink:0}}>{"data["+(currentLevel+1)+"]>"}</span>
        <input ref={inputRef} type="text" value={input} onChange={function(e){setInput(e.target.value);}} onKeyDown={handleKey} autoFocus spellCheck={false} autoComplete="off" style={{flex:1,background:"none",border:"none",color:"#e2e8f0",fontSize:13,fontFamily:"inherit",outline:"none",caretColor:"#818cf8"}} />
      </div>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<DataAIGame />);
    </script>
</body>
</html>